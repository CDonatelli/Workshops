---
title: "Introduction to R"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

NOTE: This document is modified from a document created in collaboration with Dr. Trina Du

#### PART 1: THE BASICS ####
# In this section, we will learn about variables and functions, data types and structures, and how to set up your working environment in R

# Variables are containers that hold information.

```{r}
x <- 8 # Variables can be very simple
x = 8  # Value(s) are assigned to variables using the <- or =
x      # You can print the value of a variable by typing it (mainly effective for simple variances)
```

# Functions are chunks of code that do a specific task
```{r}
numbers = 1:4 # Let's make a variable

# Some important basic functions
sum(numbers) # get the sum of vector elements
length(numbers) # get the length of a vector
c(1,2,3,4) # concatenate
mean(numbers) # mean
sd(numbers) # standard deviation

# You can assign the output of a function to a variable to use later
sem<-sd(numbers)/sqrt(length(numbers)) # standard error

# You can do mathematical operations with a combination of variables and functions using the normal mathematical operators and brackets
C1<-c(mean(numbers)-1.96*sem,mean(numbers)+1.96*sem) # 95% confidence intervals of the mean

# Access the help file of a function by typing help(functionName) or searching in the lower-right window
help("t.test")
```

# Information in R (and other programming languages) can be represented by different data types and data structures

# The previous examples were of numeric type

```{r}
# The Character type can hold single characters or strings of characters
char1<-'1'
char2<-'hello'
c(char1, char2)
c(1, char2) # If you try to put a character and numeric type together, they will both become characters
```

```{r}
# The Logical type has only two values (TRUE or FALSE) (1 or 0)
logi<-c(TRUE, FALSE)

# If you ask R to compare two things, it will return a Logical
# These operators (==, <, >, !=) are called "Locical operators"
1<2
2==1
2!=1
1>=1
```

```{r}
# Factors are useful for grouping other variables (more on this later)
factor(c(0,0,0,1,1,1,2,2,2,3,3,3))
```

#The data structures you will use most often in R are vectors, matrices, and dataframes (more later)
```{r}
# Vectors
vec1<-c(2, 4, 6)
vec2<-2:6
vec3<-seq(2, 3, by=0.5)
vec4<-rep(1:2, each=3)

vec1
vec2
vec3
vec4
```

```{r}
# Matrices
mat1 <- matrix(1:10, nrow = 5)
mat1
```

#Working Directory and Packages#
Setting up a working directory makes it easy to organize your files

Let's start by making a folder for this workshop. Go to your Desktop, right
click, and select "create new folder". Name it "R Workshop"

Back here in R, you can set your working directory
  You can do this by opening the "Session" menu above, hovering over 
  "set working directory" and then clicking on "Choose Directory ..."
  A window will pop up which will allow you to select  folder on your computer.
  You should choose the folder where your data is stored.
      

# Packages
Since R is open source, lots of people write code to make it more useful. These
chunks of code are called Packages.

You need to install packages before you can load them. 
  You can do this in your Console by typing install.packages("NAME") where "NAME"
  is the name of the package you are interested in (like ggplot2 below)
```{r}
library(ggplot2)
library(car)
library(plyr)
library(Hmisc)
```

#### PART 2: WORKING WITH DATA FRAMES ####
Most of the data you collect can be stored in spreadsheets, CSVs, or text files
In R, you can load this data in as a type called a dataframe.

# Load in data
  I sent the data your way over email, but if you need it you can find it below
  The mtcars dataset: https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/mtcars
```{r}
carData=read.csv(file.choose())
carData2 = mtcars
```

# You can refer to specific values in a dataset [row,column]
```{r}
carData[1,4]

# Or data ranges [rows,columns]
carData[1:3,1:7]

# Or (for datasets), specific variables
carData$mpg

# Any of the above can be assigned to a variable
a=carData[1,4]
b=carData[1:3,1:7]
c=carData$mpg

# Can also see the first or last 6 rows of a dataset with head() & tail()
head(carData)
tail(carData)

# Calculate summary statistics by group using plyr package
carStats = ddply(carData,.(factor(cyl)),summarise,
                  n = length(mpg),
                  m = mean(mpg,na.rm=T),
                  std = sd(mpg,na.rm=T),
                  se = sd(mpg,na.rm=T)/sqrt(n))
show(carStats) # Show your summary statistics.
```

#### PART 3: DIAGNOSTICS AND TESTING ASSUMPTIONS ####

# Let's make some simple plots of our data
```{r}
# Basic scatterplot
plot(carData$hp, carData$mpg)
plot(carData$cyl, carData$qsec)

# Basic histogram
hist(carData$mpg)
hist(carData$hp)

# QQplots for visually inspecting normality
qqPlot(carData$mpg, envelope=FALSE)
qqPlot(carData$hp, envelope=FALSE)
```


# Testing assumptions
```{r}
# Normality
  # When this test gives a significant p-value, it means that you data 
  # departs from the null hypothesis of normality
shapiro.test(carData$mpg)
shapiro.test(carData$hp)

# Equal variances
  # The by() function lets us perform a function on different groups of data
  # output<- c(dependentVariable, groupingFactor, functionName)
by(carData$mpg,factor(carData$am),var)
by(carData$mpg,factor(carData$vs),var)

# Levene Test
  # When this test gives a significant p-value, it means that you data 
  # departs from the null hypothesis of equal variances
leveneTest(carData$mpg, factor(carData$am)) # Here we need to give a grouping factor
leveneTest(carData$mpg, factor(carData$vs))
```

#### PART 4: STATISTICAL TESTS ####

# T-test
```{r}
plot(carData$vs, carData$mpg)
vs0<-carData$mpg[carData$vs==0]
vs1<-carData$mpg[carData$vs==1]

# newModel<-t.test(scores group 1, scores group 2, paired = FALSE/TRUE)
t.test(vs0,vs1, var.equal=T, alternative="two.sided")# Assume equal variance
t.test(vs0,vs1, data=carData, var.equal=T, alternative="less") # One-sided
t.test(vs0,vs1, data=carData, var.equal=T, alternative="greater") # One-sided
t.test(vs0,vs1, data=carData, var.equal=F) # Approximation for non-equal variances
t.test(vs0[1:14],vs1, paired=T) #paired t-test

```


# Using linear models with lm()
```{r}
plot(carData$hp,carData$mpg)

# Many functions require a formula: dependent variable ~ independent variable

model1<-lm(mpg~hp, data=carData) # Many functions have a "data=" parameters. Put the variable name of your dataset here, then you don't have to use the $ for the column names
summary(model1) #more details!
```


# One-way ANOVAs
```{r}
show(s) #Recall that we alredy calculated summary statistics for mpg. The means differ, but are they significantly different?

# There are two different ways of running an ANOVA in R. They are equivalent but will print slightly different output
model2<-lm(mpg~cyl, data = carData)
model3<-aov(mpg ~ cyl, data = carData)
Anova(model3,type="III") # Get an ANOVA table
```

# Post-hoc tests
```{r}
#pairwise.t.test(outcome, predictor, paired = FALSE, p.adjust.method = "method")

pairwise.t.test(carData$mpg, carData$cyl, paired=FALSE, p.adjust.method="bonferroni")
```

# Two-way ANOVA
```{r}
model4<-aov(mpg ~ vs*am, data = carData) # * indicates you want to test the interaction between two independent variables
summary(model4) #Type I sums of squares
Anova(model4) #Type II sums of squares
Anova(model4,type="III") # Type III sums of squares. Unless you have reason to so otherwise, use this.

model5<-aov(mpg ~ vs + am, data = carData) # There was no significant interaction, so re-run the model without it using the +
Anova(model5) #Type II sums of squares
Anova(model5, type="III") # The results are slightly different
```

#### PART 5: GRAPHING YOUR RESULTS #### 
Basic t-test plot
```{r}
p = ggplot(carData,aes(x=factor(vs),y=mpg))+
    geom_point(aes(color=factor(vs)))

show(p)
```

Add mean
```{r}
p+stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.5,size=10)
```

Add standard error
```{r}
p+stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1)+
  stat_summary(geom = "errorbar",
               fun.data=mean_se,
               width=0.2)
```

...or standard deviation
```{r}
p+stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1)+
  stat_summary(geom = "errorbar",
               fun.data=mean_sdl,
               fun.args = list(mult = 1),
               width=0.2)
```

...or 95% confidence intervals (based on t test statistic)
```{r}
p+stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1)+
  stat_summary(geom = "errorbar",
               fun.data=mean_cl_normal,
               width=0.2)
```

Add some other things too...
```{r}
q=p+stat_summary(geom = "errorbar", 
                 fun.y = mean,
                 aes(ymin = ..y.., ymax = ..y..),
                 width=0.75,size=1)+
  stat_summary(geom = "errorbar",
               fun.data=mean_se,
               width=0.2)+
  scale_color_manual(values=c('red','blue'),
                     labels=c('Bacon','Eggs'),
                     name=c('Something Informative'))+                       #Change the color and labels for your categories.
  labs(x = "Breakfast", y = "How far the car runs") +                 #Label your axes
  annotate("text",x=c(2),y=c(35),label=c("*"),size=15)+               #Add a denoter of statistical significance
  theme_bw()+
  theme(panel.grid.major = element_blank(),                           #Take away the grid in the plot
        panel.grid.minor = element_blank(),               
        legend.text=element_text(size=18),                            #Change the size of the legend text (not the title)
        axis.title.y=element_text(vjust=5),                           #Change the position of the y axis title
        axis.title.x=element_blank(),                                 #Get rid of your x axis title
        axis.text.x=element_blank(),                                  #Get rid of you x axis labels
        text=element_text(size=40, family="serif"),                   #Make the rest of the font bigger and Times New Roman
        plot.margin=unit(c(1,1,0.5,1.1),"cm"))                        #Change some margins so that things fit nicely.

show(q)
```

Use tge ggsave function to save your output. 
  You can save as an image file (png, jpg, tiff, etc.) 
  or a vector graphic (eps, pdf, etc.)
  be sure to set the dimensions properly
```{r}
ggsave(q, filename = "BestPlotEver.png",  bg = "transparent",width=8,height=7) 
```

# ANOVA Graph
```{r}
ggplot(carData,aes(x=factor(cyl),y=mpg))+
  geom_point(aes(color=factor(cyl)))+
  stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1)+
  stat_summary(geom = "errorbar",
               fun.data=mean_se,
               width=0.2)+
  scale_color_manual(values=c('red','blue','green'),
                     labels=c('Bacon','Eggs','toast'),
                     name=c('Something'))+                       #Change the color and labels for your categories.
  labs(x = "Breakfast", y = "How far the car runs") +                 #Label your axes
  annotate("text",x=c(2),y=c(35),label=c("*"),size=15)+               #Add a denoter of statistical significance
  theme_bw()+                                                         #Change the "theme" to a prettier one.
  theme(panel.grid.major = element_blank(),                           #Take away the grid in the plot
        panel.grid.minor = element_blank(),               
        legend.text=element_text(size=18),                            #Change the size of the legend text (not the title)
        axis.title.y=element_text(vjust=5),                           #Change the position of the y axis title
        axis.title.x=element_blank(),                                 #Get rid of your x axis title
        axis.text.x=element_blank(),                                  #Get rid of you x axis labels
        text=element_text(size=40, family="serif"),                   #Make the rest of the font bigger and Times New Roman
        plot.margin=unit(c(1,1,0.5,1.1),"cm"))                        #Change some margins so that things fit nicely.
```

# 2-Way ANOVA Graph
```{r}
ggplot(carData,aes(x=factor(cyl),y=mpg,color=factor(am)))+
  geom_point(aes(color=factor(am)),position=position_dodge(0.1))+
  stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1,
               position=position_dodge(0.9))+
  stat_summary(geom = "errorbar",
               fun.data=mean_se,
               width=0.2,
               position=position_dodge(.9))+
  scale_color_manual(values=c('red','blue','green'),
                     labels=c('Bacon','Eggs','toast'),
                     name=c('Something'))+                            #Change the color and labels for your categories.
  scale_x_discrete(name='Vessel',
                   breaks=c('4','6','8'),                             #Change the labels on your x axis.
                   labels=c('cup','plate','glass'))+                  
  labs(x = "Breakfast", y = "How far the car runs") +                 #Label your axes
  annotate("text",x=c(2),y=c(35),label=c("*"),size=15)+               #Add a denoter of statistical significance
  theme_bw()+                                                         #Change the "theme" to a prettier one.
  theme(panel.grid.major = element_blank(),                           #Take away the grid in the plot
        panel.grid.minor = element_blank(),               
        legend.text=element_text(size=18),                            #Change the size of the legend text (not the title)
        axis.title.y=element_text(vjust=5),                           #Change the position of the y axis title
        axis.title.x=element_blank(),                                 #Get rid of your x axis title
        #axis.text.x=element_blank(),                                  #Get rid of you x axis labels
        text=element_text(size=40, family="serif"),                   #Make the rest of the font bigger and Times New Roman
        plot.margin=unit(c(1,1,0.5,1.1),"cm"))                        #Change some margins so that things fit nicely.
```

# 2-Way ANOVA Graph v2
```{r}
ggplot(carData,aes(x=factor(cyl),y=mpg),color=factor(am))+
  geom_point(aes(color=factor(am)),position=position_dodge(0.9))+
  facet_grid(.~cyl)+
  stat_summary(geom = "errorbar", 
               fun.y = mean,
               aes(ymin = ..y.., ymax = ..y..),
               width=0.75,size=1,
               position=position_dodge(0.9))+
  stat_summary(geom = "errorbar",
               fun.data=mean_se,
               width=0.2,
               position=position_dodge(.9))+
  scale_color_manual(values=c('red','blue','green'),
                     labels=c('Bacon','Eggs','toast'),
                     name=c('Something'))+                            #Change the color and labels for your categories.
  scale_x_discrete(name='Vessel',
                   breaks=c('4','6','8'),                             #Change the labels on your x axis.
                   labels=c('cup','plate','glass'))+                  
  labs(x = "Breakfast", y = "How far the car runs") +                 #Label your axes
  annotate("text",x=c(2),y=c(35),label=c("*"),size=15)+               #Add a denoter of statistical significance
  theme_bw()+                                                         #Change the "theme" to a prettier one.
  theme(panel.grid.major = element_blank(),                           #Take away the grid in the plot
        panel.grid.minor = element_blank(),               
        legend.text=element_text(size=18),                            #Change the size of the legend text (not the title)
        axis.title.y=element_text(vjust=5),                           #Change the position of the y axis title
        axis.title.x=element_blank(),                                 #Get rid of your x axis title
        #axis.text.x=element_blank(),                                  #Get rid of you x axis labels
        text=element_text(size=40, family="serif"),                   #Make the rest of the font bigger and Times New Roman
        plot.margin=unit(c(1,1,0.5,1.1),"cm"))                        #Change some margins so that things fit nicely.
```

#ANCOVA Graph.
```{r}
mod1=lm(mpg~disp*factor(am),data=carData)
summary(mod1)
mod2=lm(mpg~disp+factor(am),data=carData)
summary(mod2)

coefs1=unname(mod1$coefficients)
coefs2=unname(mod2$coefficients)

```

#With interaction terms
```{r}
ggplot(carData, aes(x=disp, y=mpg, colour=factor(am))) +
  scale_colour_manual(values=c("red",'blue'))+
  geom_point(size=3) +
  geom_abline(intercept=coefs1[1],slope=coefs1[2],colour='red')+
  geom_abline(intercept=coefs1[1]+coefs1[3],slope=coefs1[2]+coefs1[4],colour='blue')+
  ylab('Thing-a-ma-jig')+
  theme_bw(base_size=22)
```

#Without interaction terms
```{r}
ggplot(carData, aes(x=disp, y=mpg, colour=factor(am))) +
  scale_colour_manual(values=c("red",'blue'))+
  geom_point(size=3) +
  geom_abline(intercept=coefs2[1],slope=coefs2[2],colour='red')+
  geom_abline(intercept=coefs2[1]+coefs2[3],slope=coefs2[2],colour='blue')+
  ylab('Thing-a-ma-jig')+
  theme_bw(base_size=22)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
